{% set name = "baumwelch" %}
{% set version = "0.3.11" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: http://206.196.111.47/twiki/pub/GRM/BaumWelchDownload/{{ name }}-{{ version }}.tar.gz
  sha256: dce976c0a7952ebdeb700e7c0ac1dc199c28b097825afc296cf713d1a0337a51
  patches:
    - patches/0001-Add-CMake-files.patch  # [win]

build:
  number: 0

requirements:
  build:
    - {{ compiler("cxx") }}
    - {{ stdlib("c") }}
    - make                    # [unix]
    - gnuconfig               # [unix]
    - cmake                   # [win]
    - ninja                   # [win]
    - m2-patch                # [win]
  host:
    - openfst ==1.8.4
    - dlfcn-win32             # [win]
    - icu                     # [win]
    - zlib                    # [win]
  run:
    - openfst ==1.8.4
    - ucrt                    # [win]

{% set baumwelch_binaries = [
    "baumwelchdecode", "baumwelchrandomize", "baumwelchtrain"
] %}

test:
  commands:
    # binaries:
    {% for each_bin in baumwelch_binaries %}
      # If behaving properly these will have return code 1.
    - {{ each_bin }} --helpshort >/dev/null || [[ $? == 1 ]]       # [unix]
    - {{ each_bin }} --helpshort & if errorlevel 1 ( exit /b 0)    # [win]
    {% endfor %}

about:
  home: http://baumwelch.opengrm.org
  license: Apache-2.0
  license_file: LICENSE
  summary: Baum-Welch/expectation-maximization training and decoding
  description: |
    A library for estimating the parameters of a discrete HMM
  doc_url: http://www.opengrm.org/twiki/bin/view/GRM/BaumWelchDocs

extra:
  recipe-maintainers:
    - kylebgorman
    - mmcauliffe
